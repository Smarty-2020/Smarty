!function(r){"use strict";r(document).ready(function(){var d;r(document).on("click",".yz-edit-activity, .yz-edit-post",function(t){if(t.preventDefault(),!r(".yz-edit-activity.loading,.yz-edit-post.loading")[0]){var i=r(this),n=i.parents("li").attr("id").split("-")[1],o=i.attr("data-activity-type");if(!i.hasClass("loading")){i.addClass("loading"),d=i,r("#youzer-edit-activity-wrapper");var e={action:"yz_get_edit_activity_form",yz_edit_activity_nonce:Youzer.security_nonce,activity_id:n,activity_type:o};r.post(Youzer.ajax_url,e,function(t){if((t=r.parseJSON(t)).remove_button)return d.remove(),void r.yz_DialogMsg("error",t.error);i.attr("data-loaded","true"),i.removeClass("loading");var a=r(t.form);if(t.privacy&&a.find('select.yz-activity-privacy option[value="'+t.privacy+'"]').attr("selected",!0),t.tagged_friends&&(console.log(t.tagged_friends),a.find(".yz-tagged-users").append(t.tagged_friends),0!=a.find(".yz-tagged-user").length&&a.find(".yz-tagged-users").fadeIn()),t.mood&&(a.find(".yz-feeling-title").text(t.mood.title),a.find('input[name="mood_type"]').val(t.mood.type),a.find(".yz-feeling-selected-items").append(t.mood.content).fadeIn(),a.find(".yz-wall-feeling").addClass("yz-activity-feeling-selected")),jQuery.isFunction(r.fn.niceSelect)&&a.find('select:not([multiple="multiple"])').niceSelect(),r("body").append(a),a.find("form").attr("action",""),a.find('input[name="post_type"]')[0]||a.find(".yz-wall-options").append('<input type="hidden" value="'+o+'" name="post_type" />'),a.find('input:radio[name="post_type"]').first().trigger("change"),"activity_comment"==o&&"on"==t.comment_attachments&&(a.find(".yz-upload-attachments").removeAttr("accept"),a.find(".yz-wall-upload-btn").fadeIn()),a.find("#whats-new-post-in-box").remove(),a.find(".yz-wall-options").hide(),a.find(".yz-wall-attchments")[0]&&a.find(".yz-wall-actions").detach().insertAfter(a.find(".yz-wall-attchments")),"activity_giphy"==o&&t.meta.giphy_image&&a.find(".yz-wall-giphy-form .yz-wall-cf-item").hide(1,function(){a.find(".yz-selected-giphy-item").show(1).css("display","inline-block").prepend('<img  src="'+t.meta.giphy_image+'" alt="">'),a.find('.yz-selected-giphy-item input[name="giphy_image"]').val(t.meta.giphy_image)}),a.find('textarea[name="status"]').val(t.content),"activity_comment"==o&&"on"==t.comments_emojis||"activity_comment"!=o&&"on"==t.posts_emojis?jQuery().emojioneArea?a.find(".yz-wall-textarea").emojioneArea({pickerPosition:"bottom",autocomplete:!0,saveEmojisAs:"image",events:{ready:function(){this.editor.textcomplete([{id:"yz_mentions",match:/\B@([\-\d\w]*)$/,search:function(e,t){var a=bp.mentions.users;t(r.map(a,function(t){return 0===t.ID.indexOf(e)||0===t.name.indexOf(e)?t:null}))},template:function(t){return'<img src="'+t.image+'" /><span class="username">@'+t.ID+"</span><small>"+t.name+"</small>"},replace:function(t){return"@"+t.ID+"&nbsp;"},cache:!0,index:1}])}}}):(r("<script/>",{rel:"text/javascript",src:Youzer.assets+"js/emojionearea.min.js"}).appendTo("head"),r("<link/>",{rel:"stylesheet",href:Youzer.assets+"css/emojionearea.min.css"}).appendTo("head")):a.find(".yz-load-emojis").remove(),a.find(".yz-wall-post").attr({class:"yz-update-post","data-activity-type":o,"data-activity-id":n}).text(Youzer.save_changes),r.each(t.meta,function(t,e){a.find('.yz-wall-cf-input[name="'+t+'"]').val(e)}),"hide"==t.attachments?a.find(".yz-wall-upload-btn").remove():(yz_load_attachments||(r("<script/>",{rel:"text/javascript",src:Youzer.assets+"js/yz-attachments.min.js"}).appendTo("head"),r("<link/>",{rel:"stylesheet",href:Youzer.assets+"css/yz-attachments.min.css"}).appendTo("head"),yz_load_attachments=!0),a.find(".yz-form-attachments").html(t.attachments)),t.url_preview){var e=a.find(".yz-lp-prepost");e.attr("data-loaded",!0),r.yz_set_live_preview_form(e,t.url_preview)}a.css({position:"absolute",top:r(document).scrollTop()+100}),r(".yz-modal-overlay")[0]?r(".yz-modal-overlay").fadeIn():r("body").append('<div class="yz-modal-overlay"></div>')}).fail(function(t,e,a){return i.removeClass("loading"),r.yz_DialogMsg("error",Youzer.unknown_error),!1})}}}),r(document).on("click",".yz-update-post",function(t){t.preventDefault();r(this).attr("data-activity-type");var a=r(this),i=r(this).text(),e=r(this).closest("#yz-wall-form"),n=d.parent().hasClass("activity-meta")||d.parent().hasClass("yz-activity-tools")?"activity":"comment",o={};if(!a.hasClass("loading")){a.addClass("loading"),a.html('<i class="fas fa-spinner fa-spin"></i>'),jQuery.each(e.serializeArray(),function(t,e){"_"!==e.name.substr(0,1)&&"whats-new"!==e.name.substr(0,9)&&(o[e.name]?jQuery.isArray(o[e.name])?o[e.name].push(e.value):o[e.name]=new Array(o[e.name],e.value):o[e.name]=e.value)});var s=r.extend({action:"yz_save_activity_edit_form",yz_edit_activity_nonce:e.find('input[name="yz_edit_activity_nonce"]').val(),activity_id:r(this).data("activity-id"),content:e.find(".yz-wall-textarea").val(),target:n},o);r.ajax({type:"POST",url:ajaxurl,data:s,success:function(t){if(r.yz_isJSON(t)){var e=r.parseJSON(t);if(e.error)return a.removeClass("loading"),a.text(i),e.remove_modal&&(r.yzea_hide_modal(a),d.remove()),void r.yz_DialogMsg("error",e.error)}"comment"==n&&e.content&&r("li#acomment-"+s.activity_id).find(".acomment-content").first().html("<p>"+e.content+"</p>").show(),"activity"==n&&(r("li#activity-"+s.activity_id).replaceWith(t),r("li#activity-"+s.activity_id).hasClass("activity_slideshow")&&r.youzer_sliders_init()),r.yzea_hide_modal(a)}})}}),r(document).on("click","#yz-edit-activity-form .yz-delete-attachment",function(t){var e=r(this).closest(".yz-attachment-item").attr("data-item-id");e&&r(document).find("#yz-edit-activity-form .yz-wall-attachments").append('<input type="hidden" name="delete_attachments[]" value="'+e+'" >')}),r.yzea_hide_modal=function(t){r(".yz-modal-overlay").fadeOut(300,function(){t.closest(".yz-modal").fadeOut(300,function(){r(this).remove()})})}})}(jQuery);